# é›†ç¾¤æ­å»º

* ç›®æ ‡
  * èƒ½å¤Ÿé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬éƒ¨ç½²ä¸€ä¸ªé›†ç¾¤
* æ­¥éª¤
  1. ä¸ºä¼ä¸šè®¾è®¡ä¸€ä¸ªè§„æ¨¡åˆé€‚çš„é›†ç¾¤
  2. ä¼ä¸šä¸­éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤çš„å·¥å…·
  3. è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿæœº
  4. è‡ªåŠ¨åŒ–éƒ¨ç½²æœåŠ¡

## 3. è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿæœº



* ç›®æ ‡
  * èƒ½å¤Ÿé€šè¿‡è‡ªåŠ¨åŒ–çš„æ–¹å¼åˆ›å»ºè™šæ‹Ÿæœº
* æ­¥éª¤
  1. ä»€ä¹ˆæ˜¯ Vagrant
  2. å®‰è£… Vagrant å’Œæ¦‚å¿µä»‹ç»
  3. ä½¿ç”¨ Vagrant æ„å»ºä¸€ä¸ªè™šæ‹Ÿæœºé›†ç¾¤



### 3.1. ä»€ä¹ˆæ˜¯ Vagrant



**ä»ç°åœ¨å°±å¼€å§‹è¦æ­å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤äº†, å›é¡¾å‰é¢çš„è¯¾ç¨‹, å…ˆæ¥è¯´è¯´è™šæ‹Ÿæœºçš„ç—›ç‚¹**



* å®‰è£…éº»çƒ¦
  * å»ºç«‹è™šæ‹Ÿæœºçš„æ—¶å€™, æˆ‘çš„ç½‘æ®µå¥½åƒå†™é”™äº†, å’Œåˆ«äººçš„ IP ä¸ä¸€æ ·, æ€»æ˜¯æ“ä½œå¤±è¯¯
  * è™šæ‹Ÿæœºå¼„å¥½ä»¥å, è¿˜éœ€è¦å®‰è£…æ“ä½œç³»ç»Ÿ, æ­¥éª¤é‚£ä¹ˆå¤š, æ€ä¹ˆå¯èƒ½ä¸å‡ºé”™å‘¢, è€å¸ˆä½ è‚¯å®šæ²¡è®²æ¸…æ¥š
  * WC, è™šæ‹Ÿæœºç»ˆäºè£…å¥½äº†!! ä»€ä¹ˆ? è¿˜éœ€è¦å®‰è£… Hadoop, å‡ åä¸ªæ­¥éª¤!!!!!!
* å·¥ç¨‹å’Œç¯å¢ƒåˆ†ç¦»
  * å”‰, åˆè¦å­¦ä¹ æ–°é¡¹ç›®äº†, åˆè¦æŠ˜è…¾ç¯å¢ƒ, ç®—äº†, è¯·ä¸€å¤©å‡æ”¾æ¾æ”¾æ¾
* åˆ†å‘å›°éš¾
  * ä¸ºå•¥è€å¸ˆå‘ç»™æˆ‘çš„è™šæ‹Ÿæœºæˆ‘è¿è¡Œä¸èµ·æ¥? è¿™æ˜¯ä¸ºä»€ä¹ˆ!!!
  * å¯èƒ½å› ä¸ºä½ å’Œè€å¸ˆçš„ç¯å¢ƒä¸åŒ. ä»€ä¹ˆ!? åˆæ˜¯ç¯å¢ƒä¸åŒ!!!



å’ğŸ˜©



**ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜, æœ¬é¡¹ç›®ä¸­ä¸ºå¤§å®¶å¼•å…¥ Vagrant** 



* Vagrant å¯ä»¥é€šè¿‡ä¸€ä¸ªè„šæœ¬é…ç½®è™šæ‹Ÿæœºçš„å‚æ•°
* Vagrant å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœº
* Vagrant å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å®‰è£…æ“ä½œç³»ç»Ÿ
* Vagrant å¯ä»¥å¸®åŠ©æˆ‘ä»¬é…ç½®ç½‘ç»œ
* Vagrant å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠæ–‡ä»¶æ‹·è´åˆ°åˆ›å»ºå¥½çš„è™šæ‹Ÿæœºä¸Š
* Vagrant å¯ä»¥åœ¨åˆ›å»ºè™šæ‹Ÿæœºå, æ‰§è¡Œæˆ‘ä»¬åˆ¶å®šçš„è‡ªåŠ¨åŒ–è„šæœ¬, å®‰è£…æœåŠ¡
* æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Vagrant çš„å‘½ä»¤ç™»å½•åˆ°è™šæ‹Ÿæœºä¸­
* æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Vagrant çš„å‘½ä»¤å¼€å¯æˆ–è€…å…³é—­è™šæ‹Ÿæœº



å¤§å®¶æƒ³ä¸€ä¸‹, å¦‚æœæˆ‘ä»¬å¯ä»¥é€šè¿‡ Vagrant, ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥åˆ›å»ºè™šæ‹Ÿæœº, æ˜¯ä¸æ˜¯å°±èƒ½åšåˆ°å¦‚ä¸‹äº‹æƒ…



* åˆ›å»ºä¸€ä¸ªé¡¹ç›®, é¡ºæ‰‹å†™ä¸€ä¸ªè„šæœ¬, éœ€è¦è¿è¡Œé¡¹ç›®çš„æ—¶å€™, è®©åŒäº‹æ‰§è¡Œè„šæœ¬å³å¯
* è™šæ‹Ÿæœºä¸­çš„ç¨‹åºç‰ˆæœ¬å˜åŒ–äº†, ä¿®æ”¹ä¸€ä¸‹è„šæœ¬, åŒäº‹é‡æ–°è¿è¡Œä¸€ä¸‹è„šæœ¬å³å¯åŒæ­¥ç¯å¢ƒå˜åŠ¨
* å†ä¹Ÿä¸ç”¨æ‹…å¿ƒè™šæ‹Ÿæœºå…³é—­ä»¥åå†ä¹Ÿæ‰“ä¸å¼€, é‡æ–°è¿è¡Œä¸€ä¸‹å°±å¥½, ä¹Ÿå°±ä¸€åˆ†é’Ÿ



æ‰€ä»¥, ä¸ä»…ä»…æ˜¯ä¸ºäº†è®©å¤§å®¶å­¦ä¹ , å¾ˆå¤šä¼ä¸šä¸­ä¹Ÿä½¿ç”¨ Vagrant æ„å»ºæµ‹è¯•ç¯å¢ƒ, ä¿è¯æ¯ä¸ªäººçš„ç¯å¢ƒä¸€è‡´



### 3.2. å®‰è£… Vagrant å’Œæ¦‚å¿µä»‹ç»



**å®‰è£…æ­¥éª¤å¦‚ä¸‹**



1. ä¸‹è½½ VirtualBox, å› ä¸º VMWare æ˜¯æ”¶è´¹çš„, Vagrant ä¸å…è®¸æˆ‘ä»¬ä½¿ç”¨ç ´è§£ç‰ˆ, æœ‰ç‰ˆæƒé—®é¢˜
2. å®‰è£… VirtualBox
3. ä¸‹è½½ Vagrant, åœ°å€æ˜¯ `https://releases.hashicorp.com/vagrant/2.2.7/vagrant_2.2.7_x86_64.msi`
4. å®‰è£… Vagrant
5. è€ƒè™‘åˆ°å¤§å®¶ç½‘ç»œæ¯”è¾ƒæ…¢, å·²ç»å°†ä¸‹è½½è¿‡çš„ Vagrant ç›¸å…³çš„å®‰è£…åŒ…æ”¾åœ¨äº† `Files/Setup` ä¸­



**Vagrant ä¸­çš„æ¦‚å¿µ**



ä½œç”¨: å¸®åŠ©æˆ‘ä»¬ç®¡ç†è™šæ‹Ÿæœº, è‡ªåŠ¨åŒ–çš„åˆ›å»ºè™šæ‹Ÿæœº, è‡ªåŠ¨åŒ–çš„åˆå§‹åŒ–è™šæ‹Ÿæœº, æä¾›äº†å‘½ä»¤å¸®åŠ©æˆ‘ä»¬ç®¡ç†è™šæ‹Ÿæœº



* Vagrantfile, è¿™ä¸ªæ–‡ä»¶æ˜¯è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶
* `vagrant up`, ä½¿ç”¨è¿™ä¸ªå‘½ä»¤, å³å¯åˆ›å»ºä¸€ä¸ªç¬¦åˆ Vagrantfile é…ç½®çš„è™šæ‹Ÿæœº
* Provision, å½“ Vagrant å»ºç«‹è™šæ‹Ÿæœºå, ä¼šæ‰§è¡Œé€šè¿‡ Provision é…ç½®çš„è‡ªåŠ¨åŒ–è„šæœ¬, è‡ªåŠ¨åŒ–çš„å®‰è£…æœåŠ¡



**Vagrant åˆä½“éªŒ, åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœº**



**æ­¥éª¤**

1. ç¼–å†™è„šæœ¬, é…ç½®è™šæ‹Ÿæœº
   1. å®šä¹‰ Vagrant é…ç½®
   2. æ–°å¢ä¸€å°è™šæ‹Ÿæœºçš„é…ç½®
   3. é…ç½®è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿ
   4. é…ç½®ç½‘ç»œ
   5. é…ç½®è™šæ‹Ÿæœºçš„ç¡¬ä»¶é…ç½®
2. æ‰§è¡Œå‘½ä»¤åˆ›å»ºè™šæ‹Ÿæœº
3. ç™»å…¥è™šæ‹Ÿæœº, æŸ¥çœ‹åŒæ­¥çš„ç›®å½•



1. ç¼–å†™è„šæœ¬ Vagrantfile

**æ–‡ä»¶å¿…é¡»å« Vagrantfileï¼Œä¸€ä¸ªå­—éƒ½ä¸èƒ½é”™ï¼Œä¸èƒ½æœ‰åç¼€**

**æ–‡ä»¶ä¸è¦æ”¾åœ¨å«æœ‰ä¸­æ–‡çš„è·¯å¾„ä¸­**

```ruby
# 1. å®šä¹‰ Vagrant é…ç½®
# Vagrantå†…ç½®å¯¹è±¡ 
Vagrant.configure("2") do |config|
   # 2. æ–°å¢ä¸€å°è™šæ‹Ÿæœºçš„é…ç½® edgeæ˜¯ä¸€ä¸ªæ’ä»¶ éœ€è¦å®‰è£…
   config.vm.define "edge" do |config|
       # 3. é…ç½®è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿ
       config.vm.box = 'centos/7'
       config.disksize.size = '50GB'
       # 4. é…ç½®ç½‘ç»œ
       config.vm.network 'private_network', ip: '192.168.56.101'
       config.vm.hostname = 'edge'
       
       # 5. é…ç½®è™šæ‹Ÿæœºçš„ç¡¬ä»¶é…ç½® è”ç³»virtualbox
       config.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'edge'
           vb.memory = 2048
           vb.cpus = 1
           # CPUä½¿ç”¨æ¯”ä¾‹
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end
end
```

2. åœ¨è„šæœ¬æ‰€åœ¨ç›®å½•æ‰§è¡Œå‘½ä»¤

```shell
# å› ä¸ºç”¨åˆ°äº†ä¿®æ”¹ç£ç›˜å¤§å°çš„æ’ä»¶, éœ€è¦å®‰è£…
vagrant plugin install vagrant-disksize

# å»ºç«‹è™šæ‹Ÿæœº
vagrant up
```

   

3. åœ¨powershellä¸­ç™»å…¥è™šæ‹Ÿæœº, æŸ¥çœ‹åŒæ­¥çš„ç›®å½•

```shell
# ç™»å½•
vagrant ssh edge

# æŸ¥çœ‹åŒæ­¥çš„ç›®å½•
cd /vagrant

# åˆ‡æ¢åˆ°root
sudo -i

cd /vagrant

ll
```


æ³¨æ„ï¼šå¦‚æœsshæŠ¥é”™vagrant@127.0.0.1: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).
1. ä¿®æ”¹D:\Program Files\vagrantvms\test\.vagrant\machines\edge\virtualboxä¸‹çš„private_keyçš„è®¿é—®å±æ€§ï¼Œæ·»åŠ åˆ°å½“å‰ç”¨æˆ·èƒ½è®¿é—®ã€‚
2. å³é”® å±æ€§ å®‰å…¨ é«˜çº§ æ·»åŠ  ç¦ç”¨ç»§æ‰¿ ç¡®å®šå³å¯

**Vagrant è¿˜æœ‰ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½, å°±æ˜¯åœ¨åˆ›å»ºè™šæ‹Ÿæœºå®Œæ¯•æ—¶, æ‰§è¡Œåˆå§‹åŒ–ä»»åŠ¡**

1. å…³é—­å·²ç»åˆ›å»ºçš„è™šæ‹Ÿæœº

```shell
vagrant destroy
```

2. ç¼–å†™è„šæœ¬

```ruby
Vagrant.configure("2") do |config|
   config.vm.define "edge" do |config|
       config.vm.box = 'centos/7'
       config.disksize.size = '50GB'
       config.vm.network 'private_network', ip: '192.168.56.101'
       config.vm.hostname = 'edge'

       config.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'edge'
           vb.memory = 2048
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
     
       config.vm.provision "shell", path: "script.sh"
   end
end
```

   

3. ç¼–å†™ Shell è„šæœ¬

   ```shell
   echo "Hello everyone"
   ```

   

4. è¿è¡ŒæŸ¥çœ‹

   ```shell
   vagrant up
   ```

   

ç›®å‰, é™¤äº† Shell çš„ Provision, Vagrant è¿˜æ”¯æŒ Ansible, Chef, Docker, Puppet ç­‰



### 3.3. ä½¿ç”¨ Vagrant æ„å»ºä¸€ä¸ªè™šæ‹Ÿæœºé›†ç¾¤



æ¥ä¸‹æ¥, è¦ä½¿ç”¨ Vagrant æ„å»ºä¸€ä¸ªé›†ç¾¤äº†, åœ¨å¼€å§‹ä¹‹å‰, æ ¹æ®æˆ‘ä»¬çš„æƒ…å†µ, è¦è§„åˆ’ä¸€ä¸‹é›†ç¾¤



| ä¸»æœºå          | è§’è‰²   | é…ç½®                          |
| :-------------- | :----- | :---------------------------- |
| master01        | Master | 1 cores, 16G -> 6G, 32G -> 8G |
| workder 01 - 02 | Worker | 1 cores, 16G -> 4G, 32G -> 5G |



* å¦‚æœåªæœ‰ 8G å†…å­˜, å»ºè®®å»ä¸‹è½½ Cloudera quick start vm
* Cloudera CDH çš„æ¯ä¸€ä¸ªæœåŠ¡çš„å†…å­˜é…ç½®, æ˜¯æŒ‰ç…§æ¯”ä¾‹æ¥çš„



ç„¶å, è¿›è¡Œé›†ç¾¤æ­å»º



1. ç¼–å†™è„šæœ¬

```ruby
Vagrant.configure("2") do |config|
   config.vm.define "master01" do |master01|
       master01.vm.box = 'centos/7'
       master01.disksize.size = '50GB'
       master01.vm.network 'private_network', ip: '192.168.56.101'
       master01.vm.hostname = 'master01'

       master01.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'master01'
           vb.memory = 6000
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "worker01" do |worker01|
       worker01.vm.box = 'centos/7'
       worker01.disksize.size = '50GB'
       worker01.vm.network 'private_network', ip: '192.168.56.102'
       worker01.vm.hostname = 'worker01'

       worker01.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'worker01'
           vb.memory = 2048
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "worker02" do |worker02|
       worker02.vm.box = 'centos/7'
       worker02.disksize.size = '50GB'
       worker02.vm.network 'private_network', ip: '192.168.56.103'
       worker02.vm.hostname = 'worker02'

       worker02.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'worker02'
           vb.memory = 2048
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "edge" do |edge|
       edge.vm.box = 'centos/7'
       edge.disksize.size = '50GB'
       edge.vm.network 'private_network', ip: '192.168.56.104'
       edge.vm.hostname = 'edge'

       edge.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'edge'
           vb.memory = 1024
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end
end
```

   

2. è¿è¡Œé›†ç¾¤

```shell
vagrant up
```

   

**è¿™ä¸ªæ—¶å€™, æˆ‘ä»¬å·²ç»å»ºç«‹èµ·æ¥äº†æµ‹è¯•é›†ç¾¤, ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜, ä¼¼ä¹æ— æ³•åœ¨å¤–éƒ¨ç™»å½•**

**è¦ä¿®æ”¹hostæ–‡ä»¶å¯¹åº”IP**

1. ä½¿ç”¨ MobaXterm ä½¿ç”¨ SSH ç™»å½•è™šæ‹Ÿæœº
2. å‘ç°æ— æ³•ç™»å½•



åŸå› æ˜¯, Vagrant è‡ªåŠ¨åˆ›å»ºå‡ºæ¥çš„è™šæ‹Ÿæœºæ˜¯å…³é—­äº† SSH ç™»å½•åŠŸèƒ½çš„, åªèƒ½ä½¿ç”¨ `vagrant ssh` ç™»å½•, è¿™æ˜¯ä¸ºäº†ä¿éšœå®‰å…¨æ€§, ä½†æ˜¯æµ‹è¯•é›†ç¾¤çš„è¯, å…¶å®æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å®ƒæ–¹ä¾¿, è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•, ä¿®æ”¹ SSH é…ç½®, å†æ‰“åŒ…ä¸€ä¸‹ç³»ç»Ÿ, è®© Vagrant ä¸‹æ¬¡åˆ›å»ºçš„æ—¶å€™ä½¿ç”¨æˆ‘ä»¬ä¿®æ”¹è¿‡çš„ç³»ç»Ÿ



1. ä¿®æ”¹ SSH ç™»å½•

```shell
# ä¿®æ”¹æ–‡ä»¶ /etc/ssh/sshd_config
PasswordAuthentication no
```

   

2. æ‰“åŒ…

```shell
vagrant package
```

   

3. è„šæœ¬ä¸­ä½¿ç”¨

ä½¿ç”¨æœ¬åœ°çš„./pkgs/package.boxæ„å»ºé›†ç¾¤

å’Œdockerçš„é•œåƒå¾ˆç±»ä¼¼è¿™ä¸ªpackage.boxåšäº†ä¿®æ”¹ï¼Œå¯èƒ½åŒæ­¥æœ¬åœ°æ–‡ä»¶çš„ä¿®æ”¹åˆ°é›†ç¾¤ã€‚

```shell
Vagrant.configure("2") do |config|
   config.ssh.password = "vagrant" # æ­¤å¤„ä½¿ç”¨å¯†ç ç™»å½•

   config.vm.define "master01" do |master01|
       master01.vm.box = './pkgs/package.box' # æ­¤å¤„å¼•ç”¨æ‰“åŒ…å¥½çš„ box
       master01.disksize.size = '50GB'    
       master01.vm.network 'private_network', ip: '192.168.56.101'
       master01.vm.hostname = 'master01'

       master01.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'master01'
           vb.memory = 6000
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "worker01" do |worker01|
       worker01.vm.box = './pkgs/package.box'
       worker01.disksize.size = '50GB'    
       worker01.vm.network 'private_network', ip: '192.168.56.102'
       worker01.vm.hostname = 'worker01'

       worker01.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'worker01'
           vb.memory = 2048
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "worker02" do |worker02|
       worker02.vm.box = './pkgs/package.box'
       worker02.disksize.size = '50GB'    
       worker02.vm.network 'private_network', ip: '192.168.56.103'
       worker02.vm.hostname = 'worker02'

       worker02.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'worker02'
           vb.memory = 2048
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end
   end

   config.vm.define "edge" do |edge|
       edge.vm.box = './pkgs/package.box'
       edge.disksize.size = '50GB'    
       edge.vm.network 'private_network', ip: '192.168.56.104'
       edge.vm.hostname = 'edge'

       edge.vm.provider 'virtualbox' do |vb|
           vb.gui = false
           vb.name = 'edge'
           vb.memory = 1024
           vb.cpus = 1
           vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]
       end

       edge.vm.provision "shell" do |s|
           s.path       = "install_ansible.sh"
           s.privileged = true
       end
   end
end

```

   

ä¸‹é¢å†æ¬¡æŸ¥çœ‹, å³å¯ä½¿ç”¨ MobaXterm ç™»å½•è™šæ‹Ÿæœº
